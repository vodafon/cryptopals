package c31_hmac_sha1_timing_leak

// func TestExploit(t *testing.T) {
// 	key := make([]byte, 20+rand.Intn(100))
// 	rand.Read(key)
// 	hs := NewHMACSystem(key)
// 	dur := 15 * time.Millisecond
//
// 	fn := "foo"
// 	server := NewServer(hs, dur)
// 	validHMAC := hs.HMAC([]byte(fn))
// 	fmt.Printf("\t%x\n", validHMAC)
// 	mac, err := Exploit(server, fn, dur)
// 	if err != nil {
// 		t.Fatalf("Exploit error: %s\n", err)
// 	}
// 	if !bytes.Equal(mac, validHMAC) {
// 		t.Errorf("Incorrect result. Expected %x, got %x\n", validHMAC, mac)
// 	}
// }

// === RUN   TestExploit with 5ms sleep
// 		92f3ed3aa77cb5a116e6af3f0ed59c303fd829c9
//
// 0: 	9200000000000000000000000000000000000000
// 1: 	92f3000000000000000000000000000000000000
// 2: 	92f3ed0000000000000000000000000000000000
// 3: 	92f3ed3a00000000000000000000000000000000
// 4: 	92f3ed3aa7000000000000000000000000000000
// 5: 	92f3ed3aa77c0000000000000000000000000000
// 6: 	92f3ed3aa77cb500000000000000000000000000
// 7: 	92f3ed3aa77cb5a1000000000000000000000000
// 8: 	92f3ed3aa77cb5a1160000000000000000000000
// 9: 	92f3ed3aa77cb5a116e600000000000000000000
// 10:	92f3ed3aa77cb5a116e6af000000000000000000
// 11:	92f3ed3aa77cb5a116e6af3f0000000000000000
// 12:	92f3ed3aa77cb5a116e6af3f0e00000000000000
// 13:	92f3ed3aa77cb5a116e6af3f0ed5000000000000
// 14:	92f3ed3aa77cb5a116e6af3f0ed59c0000000000
// 15:	92f3ed3aa77cb5a116e6af3f0ed59c3000000000
// 16:	92f3ed3aa77cb5a116e6af3f0ed59c303f000000
// 17:	92f3ed3aa77cb5a116e6af3f0ed59c303fd80000
// 18:	92f3ed3aa77cb5a116e6af3f0ed59c303fd82900
// 19:	92f3ed3aa77cb5a116e6af3f0ed59c303fd829c9
// --- PASS: TestExploit (125.02s)
// PASS
// ok      github.com/vodafon/cryptopals/set4/c31_c32_hmac_sha1_timing_leak    125.023s

// Min exploitable duration 3ms

// === RUN   TestExploit 3ms
// 		92f3ed3aa77cb5a116e6af3f0ed59c303fd829c9
// 0: 	9200000000000000000000000000000000000000
// 1:	92f3000000000000000000000000000000000000
// 2:	92f3ed0000000000000000000000000000000000
// 3:	92f3ed3a00000000000000000000000000000000
// 4:	92f3ed3aa7000000000000000000000000000000
// 5:	92f3ed3aa77c0000000000000000000000000000
// 6:	92f3ed3aa77cb500000000000000000000000000
// 7:	92f3ed3aa77cb5a1000000000000000000000000
// 8:	92f3ed3aa77cb5a1160000000000000000000000
// 9:	92f3ed3aa77cb5a1164300000000000000000000
// 9:	92f3ed3aa77cb5a116e6ff000000000000000000
// 10:	92f3ed3aa77cb5a116e6af000000000000000000
// 11:	92f3ed3aa77cb5a116e6af3f0000000000000000
// 12:	92f3ed3aa77cb5a116e6af3f0e00000000000000
// 13:	92f3ed3aa77cb5a116e6af3f0e2d000000000000
// 13:	92f3ed3aa77cb5a116e6af3f0e8aff0000000000
// 13:	92f3ed3aa77cb5a116e6af3f0ed5ff0000000000
// 14:	92f3ed3aa77cb5a116e6af3f0ed59c0000000000
// 15:	92f3ed3aa77cb5a116e6af3f0ed59c3000000000
// 16:	92f3ed3aa77cb5a116e6af3f0ed59c303f000000
// 17:	92f3ed3aa77cb5a116e6af3f0ed59c303fd80000
// 18:	92f3ed3aa77cb5a116e6af3f0ed59c303fd81700
// 18:	92f3ed3aa77cb5a116e6af3f0ed59c303fd829ff
// 19:	92f3ed3aa77cb5a116e6af3f0ed59c303fd829c9
// --- PASS: TestExploit (129.44s)
// PASS
// ok      github.com/vodafon/cryptopals/set4/c31_c32_hmac_sha1_timing_leak    129.446s
